services:
  # NestJS API - Connects to Amazon RDS PostgreSQL
  api:
    image: ghcr.io/urgara/jornales-urgara-api:latest
    container_name: urgara-jornales-api
    restart: unless-stopped
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      PORT: ${PORT:-3000}
      DATABASE_COMMON_URL: ${DATABASE_COMMON_URL}
      DATABASE_LOCALITY_URL: ${DATABASE_LOCALITY_URL}
      CORS_ORIGIN: ${CORS_ORIGIN}
      COOKIE_SECRET: ${COOKIE_SECRET}
      JWT_SECRET_CLIENT: ${JWT_SECRET_CLIENT}
      JWT_SECRET_REFRESH: ${JWT_SECRET_REFRESH}
      # Default admin credentials (optional, only used on first initialization)
      DEFAULT_ADMIN_DNI: ${DEFAULT_ADMIN_DNI:-12345678}
      DEFAULT_ADMIN_PASSWORD: ${DEFAULT_ADMIN_PASSWORD:-Admin123!}
      DEFAULT_ADMIN_NAME: ${DEFAULT_ADMIN_NAME:-Dynnamo}
      DEFAULT_ADMIN_SURNAME: ${DEFAULT_ADMIN_SURNAME:-Sistema}
      DEFAULT_ADMIN_ROLE: ${DEFAULT_ADMIN_ROLE:-1}
    ports:
      - '${PORT:-3000}:${PORT:-3000}'
    networks:
      - urgara-jornales-network
    volumes:
      - ./logs:/app/logs

networks:
  urgara-jornales-network:
    driver: bridge
