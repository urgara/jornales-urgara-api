// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id         String @id @db.Uuid
  name       String @db.VarChar(30)
  surname    String @db.VarChar(30)
  dni        String @unique @db.VarChar(9)
  password   String @db.VarChar
  localityId Int?

  createdAt DateTime  @default(now()) @db.Timestamptz()
  deletedAt DateTime? @db.Timestamptz()
  role      Role
  Session   Session[]
  Locality  Locality? @relation(fields: [localityId], references: [id])
}

model Session {
  id      String @id
  token   String @unique
  adminId String @db.Uuid
  ip      String
  agent   String
  Admin   Admin  @relation(fields: [adminId], references: [id])
}

model Locality {
  id          Int   @id @default(autoincrement())
  name        String @db.VarChar(100) // Nombre de la localidad donde está el puerto
  province    String @db.VarChar(100)
  createdAt   DateTime @default(now()) @db.Timestamptz()
  deletedAt   DateTime? @db.Timestamptz()

  Admin  Admin[]
  Worker Worker[]
}

model LegalEntity {
  id           Int    @id @default(autoincrement())
  abbreviation String @db.VarChar(15)
  description  String @db.VarChar(150)

  isActive Boolean @default(true)

  Company Company[]
}

model Company {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(150)
  cuit          String?   @db.VarChar(11)
  legalEntityId Int

  createdAt DateTime  @default(now()) @db.Timestamptz()
  deletedAt DateTime? @db.Timestamptz()

  LegalEntity LegalEntity @relation(fields: [legalEntityId], references: [id])
  Worker      Worker[]
}

// Turno
model WorkShift {
  id              String       @id @db.Uuid
  days            DayOfWeek[] // Días aplicables: M, T, W, Th, F, S, Su. Si está vacío, usar description
  startTime       DateTime     @db.Time
  endTime         DateTime     @db.Time
  durationMinutes Int // Duración en minutos totales, calculada automáticamente desde startTime y endTime. Ej: 510 minutos = 8.5 horas (8h 30m)
  description     String?      @db.VarChar(60)
  coefficient     Decimal      @db.Decimal(5, 2) // Coeficiente del turno (ej: 1.50, 2.00, máximo 999.99)

  createdAt DateTime  @db.Timestamptz() @default(now())
  deletedAt DateTime? @db.Timestamptz()
}

// Trabajador
model Worker {
  id         String @id @db.Uuid
  name       String @db.VarChar(100)
  surname    String @db.VarChar(100)
  dni        String @unique @db.VarChar(10)
  companyId  Int?
  localityId Int

  createdAt DateTime  @default(now()) @db.Timestamptz()
  deletedAt DateTime? @db.Timestamptz()

  Company  Company?  @relation(fields: [companyId], references: [id])
  Locality Locality @relation(fields: [localityId], references: [id])
}

enum Role {
  ADMIN    @map("1") /* acceso total */
  LOCAL    @map("5") /* El LOCAL es como un ADMIN pero solo tiene poder sobre la localidad que maneja*/
}

enum DayOfWeek {
  M  // Monday
  T  // Tuesday
  W  // Wednesday
  Th // Thursday
  F  // Friday
  S  // Saturday
  Su // Sunday
}




