// Schema para {locality}-reports-urgara
// Base de datos específica por localidad con datos operacionales

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma-locality"
}

datasource db {
  provider = "postgresql"
}

// Turno
model WorkShift {
  id              String       @id @db.Uuid
  days            DayOfWeek[] // Días aplicables: M, T, W, Th, F, S, Su. Si está vacío, usar description
  startTime       DateTime     @db.Time
  endTime         DateTime     @db.Time
  durationMinutes Int // Duración en minutos totales, calculada automáticamente desde startTime y endTime. Ej: 510 minutos = 8.5 horas (8h 30m)
  description     String?      @db.VarChar(60)
  coefficient     Decimal      @db.Decimal(5, 2) // Coeficiente del turno (ej: 1.50, 2.00, máximo 999.99)

  createdAt DateTime  @db.Timestamptz() @default(now())
  deletedAt DateTime? @db.Timestamptz()

  WorkerAssignment WorkerAssignment[]
}

model WorkShiftBaseValue {
  id String @id @db.Uuid
  remunerated Decimal @db.Decimal(8, 2)
  notRemunerated Decimal @db.Decimal(8, 2)

  startDate DateTime @db.Timestamptz()
  endDate DateTime @db.Timestamptz()

  category Category

  workShiftCalculatedValues WorkShiftCalculatedValue[]
}

model WorkShiftCalculatedValue {
  workShiftBaseValueId String  @db.Uuid
  coefficient          Decimal @db.Decimal(5, 2)
  remunerated          Decimal @db.Decimal(8, 2)
  notRemunerated       Decimal @db.Decimal(8, 2)
  gross                Decimal @db.Decimal(10, 2) // Monto bruto: remunerated + notRemunerated
  net                  Decimal @db.Decimal(10, 2) // Monto neto: (remunerated * 0.795) + (notRemunerated * 0.965)

  WorkShiftBaseValue WorkShiftBaseValue @relation(fields: [workShiftBaseValueId], references: [id])

  @@id([coefficient,workShiftBaseValueId])
}

// Trabajador
model Worker {
  id         String   @id @db.Uuid
  name       String   @db.VarChar(100)
  surname    String   @db.VarChar(100)
  dni        String   @unique @db.VarChar(10)
  localityId String   @db.Uuid // Referencia a Locality en prisma-common (sin FK)
  category   Category

  createdAt DateTime  @default(now()) @db.Timestamptz()
  deletedAt DateTime? @db.Timestamptz()

  WorkerAssignment WorkerAssignment[]
}

// Asignación de trabajador (registro histórico, no se elimina)
model WorkerAssignment {
  id                     String   @id @db.Uuid
  workerId               String   @db.Uuid
  workShiftId            String   @db.Uuid
  date                   DateTime @db.Date // Fecha de la asignación
  category               Category // Categoría del trabajador en el momento de la asignación
  workShiftBaseValueId   String   @db.Uuid // ID del valor base usado para el cálculo
  coefficient            Decimal  @db.Decimal(5, 2) // Coeficiente usado para el cálculo (del turno)
  baseValue              Decimal  @db.Decimal(10, 2) // Valor bruto total: remunerated + notRemunerated desde WorkShiftCalculatedValue
  additionalPercent      Decimal? @db.Decimal(5, 2) // Porcentaje adicional opcional (ej: 15.00 = 15%, -10.00 = -10%)
  totalAmount            Decimal  @db.Decimal(10, 2) // Monto final con el porcentaje aplicado si existiera: baseValue + (baseValue * additionalPercent/100)

  createdAt         DateTime @default(now()) @db.Timestamptz()
  companyId         String @db.Uuid
  localityId        String @db.Uuid
  agencyId          String @db.Uuid
  terminalId        String @db.Uuid
  productId         String @db.Uuid

  Worker    Worker    @relation(fields: [workerId], references: [id])
  WorkShift WorkShift @relation(fields: [workShiftId], references: [id])
  Terminal  Terminal @relation(fields: [terminalId], references: [id])
}

model Terminal{
  id   String   @id @db.Uuid
  name String @db.VarChar(50)

  workerAssignments WorkerAssignment[]
}
enum DayOfWeek {
  M  // Monday
  T  // Tuesday
  W  // Wednesday
  Th // Thursday
  F  // Friday
  S  // Saturday
  Su // Sunday
}

enum Category {
  IDONEO
  PERITO
}
